extends layout

block head
  link(rel='stylesheet' href='/stylesheets/user.css')
  script.
    var offeringList = !{JSON.stringify(offeringList)};
    var lookingForList = !{JSON.stringify(lookingForList)};

block content
  .userInfo
    .topbar
      .selfIgn= me.ign
      .selfFc= me.fc
      a#logout(onclick="location.href ='/logout';") Logout
      a#update(onclick="location.href ='/update';") Update info
    .vivillonLists
      .userOffering.selfOffering
        p Offering
        each offering in me.offering
          img(src='/images/#{offering}.png' title='#{offering}')
      hr
      .userLookingFor.selfLookingFor
        p Looking for
        each lookingFor in me.lookingFor
          img(src='/images/#{lookingFor}.png' title='#{lookingFor}')
      
  .right.messageContainer
    h2.messagesTitle Messages
    .messageBox
      each message in messages
        .message 
          - var date = message.date.toString()
          - date = date.slice(date.indexOf(" ", 3), date.indexOf(" ", 8)).concat(", ", date.slice(date.indexOf(" ", 14), date.lastIndexOf(":")))
          .messageTime= date
          if (message.content == 'addme')
            .addme.messageSubject <a href="/user/#{message.fromFc}">#{message.fromIgn}</a> wants you to add them! <br> Fc: #{message.fromFc}
          else
            .sentMessage.messageSubject <a href="/user/#{message.fromFc}">#{message.fromIgn}</a> sent you a message:
            .messageContent= message.content

      
  .left
    h3 People with Vivillons you want
    span.toggleVivillons Show irrelevant patterns
    .filterSelection Search for people that:
      span.labelSpan offer
      select.offeringSelection
        option All
        each offer in me.lookingFor
          option= offer
      span.labelSpan for
      select.lookingForSelection
        option All
        each offer in me.offering
          option= offer
    .noOffersFound No offers found with this combination!
    each user in users
      if (user.fc != me.fc)
        .userInfo.othersInfo(id='#{user.fc}')
          .topbar
            .userIgn
              a(href='/user/#{user.fc}')= user.ign
            .userFc= user.fc
          .vivillonLists
            .userOffering
              p Offering
              each offering in user.offering
                if (me.lookingFor.indexOf(offering) != -1)
                  img.smallVivillon(src='/images/#{offering}.png' title='#{offering}')
                else
                  img.smallVivillon.irrelevant(src='/images/#{offering}.png' style='display: none;' title='#{offering}')
            hr
            .userLookingFor
              p Looking for
              each lookingFor in user.lookingFor
                if (me.offering.indexOf(lookingFor) != -1)
                  img.smallVivillon(src='/images/#{lookingFor}.png' title='#{lookingFor}')
                else
                  img.smallVivillon.irrelevant(src='/images/#{lookingFor}.png' style='display: none;' title='#{lookingFor}')

